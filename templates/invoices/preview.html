{% extends "invoices/base.html" %}

{% block title %}Preview Invoice{% endblock %}

{% block content %}
<div class="card p-4">
  <h3 class="mb-4">üîç Preview Invoice {{ invoice.invoice_number }}</h3>

  <div class="row">
    <div class="col-md-6">
      <h5>From:</h5>
      <p>{{ invoice.from_party.name }}<br>{{ invoice.from_party.address_line1 }}<br>{{ invoice.from_party.city }} - {{ invoice.from_party.pincode }}<br>GST: {{ invoice.from_party.gstin }}</p>
    </div>
    <div class="col-md-6">
      <h5>To:</h5>
      <p>{{ invoice.to_party.name }}<br>{{ invoice.to_party.address_line1 }}<br>{{ invoice.to_party.city }} - {{ invoice.to_party.pincode }}<br>GST: {{ invoice.to_party.gstin }}</p>
    </div>
  </div>

  <table class="table table-bordered text-center mt-3">
    <thead class="table-light">
      <tr>
        <th>#</th>
        <th>Description</th>
        <th>HSN/SAC</th>
        <th>Qty</th>
        <th>Unit</th>
        <th>Rate</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody>
      {% for item in invoice.items.all %}
      <tr>
        <td>{{ forloop.counter }}</td>
        {% comment %} <td>{{ item.product.name if item.product else item.description }}</td> {% endcomment %}
        <td>{{ item.hsn_sac }}</td>
        <td>{{ item.quantity }}</td>
        <td>{{ item.unit.label }}</td>
        <td>{{ item.rate }}</td>
        <td>{{ item.line_taxable_amount }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="text-end mt-3">
    <p>Subtotal: <strong>{{ invoice.taxable_subtotal }}</strong></p>
    <p>Discount: <strong>-{{ invoice.total_discount_amount }}</strong></p>
    {% if invoice.apply_gst %}
      {% if invoice.is_igst %}
        <p>IGST ({{ invoice.tax.rate_percent }}%): <strong>{{ invoice.tax_amounts.igst }}</strong></p>
      {% else %}
        <p>CGST ({{ invoice.tax.rate_percent|floatformat:0|divisibleby:2 }}%): <strong>{{ invoice.tax_amounts.cgst }}</strong></p>
        <p>SGST ({{ invoice.tax.rate_percent|floatformat:0|divisibleby:2 }}%): <strong>{{ invoice.tax_amounts.sgst }}</strong></p>
      {% endif %}
    {% endif %}
    <h4>Grand Total: ‚Çπ{{ invoice.grand_total }}</h4>
  </div>

  <div class="mt-4 d-flex justify-content-end">
    <a href="{% url 'invoices:generate_pdf' invoice.pk %}" class="btn btn-success me-2">üìÑ Generate PDF</a>
    <a href="{% url 'invoices:list' %}" class="btn btn-secondary">Back</a>
  </div>
</div>
{% endblock %}
